---
title: "IBCF.MTME"
date: "Last README update: `r format(Sys.Date())`"
output: github_document
---

Item Based Collaborative Filterign For Multi-trait and Multi-environment Data in R.
[![CRAN Status][cran-badge]][cran]
[![License: LGPL v3][LGPL-badge]][LGPL]
[![Project Status: Active][status-bagde]][status]
[![Downloads][downloads-badge]][cran]
[![Release][release-badge]][cran]

## New in this dev version

* Fixed important issue from `IBCF()$predictions_Summary`, now the correlation only uses the predicted testing data.
* Now `IBCF()` function show `$yHat` that is an average of the prediction values of every partition.
* Now `IBCF()` function shows in `$predicted_Partition` all the partitions values predicted (before was `$Predictions` and was changed to not confuse with `$yHat`).
* Now `IBCF()` function shows in `$observed` all the response values from the DataSet.
* Now `IBCF()` function shows in `$Data.Obs_Pred` all the response and predicted values from the DataSet.
* Now `IBCF.Years()` function shows in `$predicted` all the values predicted.
* Now `IBCF.Years()` function shows in `$observed` the response values for all the years from the Traits selected in `Traits.testing`.
* Now `CV.RandomPart()` shows the lenght in every partition in `$CrossValidation_length`.
* Now `CV.RandomPart()` admits `Traits.testing` to only use a `PTesting` percentage defined of the traits specified in the parameter to be used to fit the model.

See the last updates in [NEWS](NEWS.md).

## Instructions for proper implementation

### Installation

To complete installation of dev version of IBCF.MTME from GitHub, you must have previously installed the devtools package.

```{r installation, eval = FALSE}
install.packages('devtools')
devtools::install_github('frahik/IBCF.MTME')
```

### Quick use 

### Load the package
```{r}
library(IBCF.MTME)
```

### Cross-validation IBCF

#### Load example data
```{r CVModel}
library(BGLR)
data(wheat)
```

#### Get DataSet in Tidy data form
```{r}
pheno <- data.frame(ID = gl(n = 599, k = 1, length = 599*4),
                    Response = as.vector(wheat.Y),
                    Env = paste0('Env', gl(n = 4, k = 599)))

head(pheno)
```

#### Generate 10 partitions to do cross-validation
```{r}
CrossV <- CV.RandomPart(pheno, NPartitions = 10, PTesting = 0.25, Set_seed = 123)
```

#### Fitting the model
```{r}
pm <- IBCF(CrossV)
```

#### Show some results
```{r}
summary(pm)
```

```{r}
par(mai = c(2, 1, 1, 1))
plot(pm, select = 'Pearson')
plot(pm, select = 'MSEP')
```




### IBCF.Years Function

```{r YearsData, echo = FALSE, warning = FALSE}
library(mvtnorm)
library(IBCF.MTME)
set.seed(2)
A <- matrix(0.65, ncol = 12, nrow = 12)
diag(A) <- 1
Sdv <- diag(c(0.9^0.5,0.8^0.5,0.9^0.5,0.8^0.5,0.86^0.5,0.7^0.5,0.9^0.5,0.8^0.5,0.9^0.5,0.7^0.5,0.7^0.5,0.85^0.5))

Sigma <- Sdv %*% A %*% Sdv
No.Lines <- 80
Z <- rmvnorm(No.Lines,mean = c(15, 15.5, 16, 15.5, 17, 16.5, 16.0, 17, 16.6, 18, 16.3, 18), sigma = Sigma)
Years <- c(rep(2014,20), rep(2015,20), rep(2016,20), rep(2017,20))
Gids <- c(1:No.Lines)

Data.Example <- data.frame(cbind(Years,Gids,Z))
colnames(Data.Example) <- c("Years","Gids","Trait1","Trait2","Trait3","Trait4","Trait5","Trait6","Trait7","Trait8","Trait9","Trait10","Trait11","Trait12")
Data.Example <- getTidyForm(Data.Example, onlyTrait = T)
save(Data.Example, file = 'DataExample.RData')
```

#### Loading your data
```{r}
load('DataExample.RData')
head(Data.Example)
```

#### Transforming the data from Tidy data to matrix form

```{r}
Data.Example <- getMatrixForm(Data.Example, onlyTrait = TRUE)
head(Data.Example)
```

#### Adjust the model
```{r Years}
pm <- IBCF.Years(Data.Example, colYears = 1, Years.testing = c('2014', '2015', '2016'), Traits.testing = c('Trait1', 'Trait2', 'Trait3', 'Trait4', "Trait5"))
```
#### Show some results
```{r}
summary(pm)

par(mai = c(3, 1, 1, 1))
barplot(pm, las = 2)
barplot(pm, select = 'MSEP', las = 2)
```

#### Load data from the package to do some test

```{r loadData}
library(IBCF.MTME)
data('Wheat_IBCF')

head(Wheat_IBCF)
```

```{r loadYearData}
data('Year_IBCF')

head(Year_IBCF)
```

## Citation

How to cite the package...
Coming soon.

## Issues

Feel free to report new issues in this link [Issues](https://github.com/frahik/IBCF.MTME/issues/new)


## Authors

 - Francisco Javier Luna-Vázquez (Author, Maintainer)
 - Osval Antonio Montesinos-López (Author)
 - Abelardo Montesinos-López (Author)
 - José Crossa (Author)

[cran-badge]: http://www.r-pkg.org/badges/version/IBCF.MTME "CRAN Page"
[LGPL-badge]: https://img.shields.io/badge/License-LGPL%20v3-blue.svg "LGPL, Version 2.0"
[status-bagde]: http://www.repostatus.org/badges/latest/active.svg "status"
[downloads-badge]: http://cranlogs.r-pkg.org/badges/IBCF.MTME) "IBCF.MTME cranlogs"
[release-badge]: http://www.r-pkg.org/badges/version-ago/IBCF.MTME "IBCF.MTME release"
[cran]: https://cran.r-project.org/package=IBCF.MTME "CRAN Page"
[LGPL]: https://www.gnu.org/licenses/lgpl-3.0 "LGPL, Version 2.0"
[status]: http://www.repostatus.org/#active "status - active"